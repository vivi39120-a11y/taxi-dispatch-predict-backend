<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>司機派車建議（Demo）</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<style>
  html, body {
    margin:0;
    height:100%;
    font-family:Arial,"微軟正黑體",sans-serif;
  }
  #app {
    display:flex;
    flex-direction:row;
    height:100vh;
    width:100vw;
  }
  #map { flex:2; }
  #panel {
    flex:1;
    border-left:1px solid #ccc;
    padding:10px;
    box-sizing:border-box;
    overflow:auto;
  }
  .zone-card {
    padding:10px;
    border:1px solid #ddd;
    border-radius:8px;
    margin-bottom:10px;
    cursor:pointer;
    font-size:13px;
  }
  .zone-card:hover { background:#f5f5f5; }
  .zone-card.selected {
    border-color:#ff9800;
    box-shadow:0 0 6px rgba(255,152,0,0.7);
  }
  .top1 { background:#ffe0b2; }
  .top2 { background:#e1f5fe; }
  .top3 { background:#e8f5e9; }
</style>
</head>

<body>
<div id="app">
  <div id="map"></div>

  <div id="panel">
    <h2>司機派車建議</h2>
    <p style="font-size:13px;">
      操作方式：<br>
      1. 在左邊地圖點一下設定司機位置<br>
      2. 系統會列出推薦前 3 名區域<br>
      3. 點任一張卡片，小車會沿道路線跑過去
    </p>

    <h3 id="driver-pos" style="font-size:14px;">尚未選擇司機位置</h3>
    <h3>推薦前 3 名區域</h3>
    <div id="rank"></div>

    <h3>說明</h3>
    <p style="font-size:12px; color:#555; line-height:1.5;">
      • <b>需求分數</b>：使用模型預測的下一小時需求量 (pred_rides)。<br>
      • <b>距離</b>：依 OSRM 公開 API 取得的道路距離 (公里)。<br>
      • <b>預估車資</b>：示意用途，假設「起跳 $2.5 + 每公里 $1.5」。<br>
      • <b>綜合分數</b>：
        <code>score = 1.0 × 需求 + 0.3 × 車資 − 0.5 × 距離</code>（可依營運需求調整）。<br>
      • <b>小車動畫</b>：點擊某推薦卡片後，車子會沿著路線行駛至該區域。
    </p>

    <p style="font-size:11px; color:#777;">
      ※ 本頁為 Demo UI，僅示範派車決策的視覺化呈現，實際派車邏輯可依營運調整。
    </p>
  </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
// ===== Python 產生的資料（已內嵌，也另外輸出 zones.json 給前端 fetch 用）=====
var zones = [{"PULocationID": 3, "pred_rides": 0.028, "Borough": "Bronx", "Zone": "Allerton/Pelham Gardens", "lat_wgs": 40.864295, "lon_wgs": -73.84651}, {"PULocationID": 4, "pred_rides": 0.029, "Borough": "Manhattan", "Zone": "Alphabet City", "lat_wgs": 40.723853, "lon_wgs": -73.975209}, {"PULocationID": 5, "pred_rides": 0.01, "Borough": "Staten Island", "Zone": "Arden Heights", "lat_wgs": 40.556678, "lon_wgs": -74.189803}, {"PULocationID": 6, "pred_rides": 0.017, "Borough": "Staten Island", "Zone": "Arrochar/Fort Wadsworth", "lat_wgs": 40.601118, "lon_wgs": -74.071747}, {"PULocationID": 7, "pred_rides": 0.163, "Borough": "Queens", "Zone": "Astoria", "lat_wgs": 40.761434, "lon_wgs": -73.919365}, {"PULocationID": 8, "pred_rides": 0.008, "Borough": "Queens", "Zone": "Astoria Park", "lat_wgs": 40.778077, "lon_wgs": -73.923396}, {"PULocationID": 9, "pred_rides": 0.014, "Borough": "Queens", "Zone": "Auburndale", "lat_wgs": 40.750303, "lon_wgs": -73.790189}, {"PULocationID": 10, "pred_rides": 0.03, "Borough": "Queens", "Zone": "Baisley Park", "lat_wgs": 40.677931, "lon_wgs": -73.790318}, {"PULocationID": 11, "pred_rides": 0.013, "Borough": "Brooklyn", "Zone": "Bath Beach", "lat_wgs": 40.602692, "lon_wgs": -74.009023}, {"PULocationID": 12, "pred_rides": 0.01, "Borough": "Manhattan", "Zone": "Battery Park", "lat_wgs": 40.702091, "lon_wgs": -74.015477}, {"PULocationID": 13, "pred_rides": 0.126, "Borough": "Manhattan", "Zone": "Battery Park City", "lat_wgs": 40.709419, "lon_wgs": -74.017326}, {"PULocationID": 14, "pred_rides": 0.063, "Borough": "Brooklyn", "Zone": "Bay Ridge", "lat_wgs": 40.625196, "lon_wgs": -74.029246}, {"PULocationID": 15, "pred_rides": 0.011, "Borough": "Queens", "Zone": "Bay Terrace/Fort Totten", "lat_wgs": 40.790995, "lon_wgs": -73.778606}, {"PULocationID": 16, "pred_rides": 0.023, "Borough": "Queens", "Zone": "Bayside", "lat_wgs": 40.762812, "lon_wgs": -73.767972}, {"PULocationID": 17, "pred_rides": 0.176, "Borough": "Brooklyn", "Zone": "Bedford", "lat_wgs": 40.692399, "lon_wgs": -73.950316}, {"PULocationID": 18, "pred_rides": 0.045, "Borough": "Bronx", "Zone": "Bedford Park", "lat_wgs": 40.868877, "lon_wgs": -73.889387}, {"PULocationID": 19, "pred_rides": 0.014, "Borough": "Queens", "Zone": "Bellerose", "lat_wgs": 40.734682, "lon_wgs": -73.72887}, {"PULocationID": 20, "pred_rides": 0.026, "Borough": "Bronx", "Zone": "Belmont", "lat_wgs": 40.858941, "lon_wgs": -73.885366}, {"PULocationID": 21, "pred_rides": 0.021, "Borough": "Brooklyn", "Zone": "Bensonhurst East", "lat_wgs": 40.596886, "lon_wgs": -73.990441}, {"PULocationID": 22, "pred_rides": 0.03, "Borough": "Brooklyn", "Zone": "Bensonhurst West", "lat_wgs": 40.608806, "lon_wgs": -73.995799}, {"PULocationID": 23, "pred_rides": 0.018, "Borough": "Staten Island", "Zone": "Bloomfield/Emerson Hill", "lat_wgs": 40.604627, "lon_wgs": -74.190512}, {"PULocationID": 24, "pred_rides": 0.023, "Borough": "Manhattan", "Zone": "Bloomingdale", "lat_wgs": 40.802947, "lon_wgs": -73.967739}, {"PULocationID": 25, "pred_rides": 0.107, "Borough": "Brooklyn", "Zone": "Boerum Hill", "lat_wgs": 40.686588, "lon_wgs": -73.985929}, {"PULocationID": 26, "pred_rides": 0.051, "Borough": "Brooklyn", "Zone": "Borough Park", "lat_wgs": 40.630738, "lon_wgs": -73.987951}, {"PULocationID": 27, "pred_rides": 0.008, "Borough": "Queens", "Zone": "Breezy Point/Fort Tilden/Riis Beach", "lat_wgs": 40.561299, "lon_wgs": -73.89082}, {"PULocationID": 28, "pred_rides": 0.026, "Borough": "Queens", "Zone": "Briarwood/Jamaica Hills", "lat_wgs": 40.712314, "lon_wgs": -73.806984}, {"PULocationID": 29, "pred_rides": 0.021, "Borough": "Brooklyn", "Zone": "Brighton Beach", "lat_wgs": 40.579934, "lon_wgs": -73.960507}, {"PULocationID": 30, "pred_rides": 0.01, "Borough": "Queens", "Zone": "Broad Channel", "lat_wgs": 40.602882, "lon_wgs": -73.822896}, {"PULocationID": 31, "pred_rides": 0.01, "Borough": "Bronx", "Zone": "Bronx Park", "lat_wgs": 40.860311, "lon_wgs": -73.875124}, {"PULocationID": 32, "pred_rides": 0.026, "Borough": "Bronx", "Zone": "Bronxdale", "lat_wgs": 40.862116, "lon_wgs": -73.865415}, {"PULocationID": 33, "pred_rides": 0.051, "Borough": "Brooklyn", "Zone": "Brooklyn Heights", "lat_wgs": 40.696964, "lon_wgs": -73.995501}, {"PULocationID": 34, "pred_rides": 0.01, "Borough": "Brooklyn", "Zone": "Brooklyn Navy Yard", "lat_wgs": 40.702702, "lon_wgs": -73.974176}, {"PULocationID": 35, "pred_rides": 0.096, "Borough": "Brooklyn", "Zone": "Brownsville", "lat_wgs": 40.663991, "lon_wgs": -73.910329}, {"PULocationID": 36, "pred_rides": 0.182, "Borough": "Brooklyn", "Zone": "Bushwick North", "lat_wgs": 40.69926, "lon_wgs": -73.916834}, {"PULocationID": 37, "pred_rides": 0.264, "Borough": "Brooklyn", "Zone": "Bushwick South", "lat_wgs": 40.695465, "lon_wgs": -73.923919}, {"PULocationID": 38, "pred_rides": 0.013, "Borough": "Queens", "Zone": "Cambria Heights", "lat_wgs": 40.695105, "lon_wgs": -73.73553}, {"PULocationID": 39, "pred_rides": 0.106, "Borough": "Brooklyn", "Zone": "Canarsie", "lat_wgs": 40.642482, "lon_wgs": -73.891706}, {"PULocationID": 40, "pred_rides": 0.029, "Borough": "Brooklyn", "Zone": "Carroll Gardens", "lat_wgs": 40.6779, "lon_wgs": -73.996626}, {"PULocationID": 41, "pred_rides": 0.121, "Borough": "Manhattan", "Zone": "Central Harlem", "lat_wgs": 40.803356, "lon_wgs": -73.950573}, {"PULocationID": 42, "pred_rides": 0.16, "Borough": "Manhattan", "Zone": "Central Harlem North", "lat_wgs": 40.826385, "lon_wgs": -73.937075}, {"PULocationID": 43, "pred_rides": 0.059, "Borough": "Manhattan", "Zone": "Central Park", "lat_wgs": 40.781507, "lon_wgs": -73.966499}, {"PULocationID": 44, "pred_rides": 0.014, "Borough": "Staten Island", "Zone": "Charleston/Tottenville", "lat_wgs": 40.52994, "lon_wgs": -74.23735}, {"PULocationID": 45, "pred_rides": 0.038, "Borough": "Manhattan", "Zone": "Chinatown", "lat_wgs": 40.711568, "lon_wgs": -73.998049}, {"PULocationID": 46, "pred_rides": 0.01, "Borough": "Bronx", "Zone": "City Island", "lat_wgs": 40.850268, "lon_wgs": -73.785851}, {"PULocationID": 47, "pred_rides": 0.035, "Borough": "Bronx", "Zone": "Claremont/Bathgate", "lat_wgs": 40.843214, "lon_wgs": -73.900472}, {"PULocationID": 48, "pred_rides": 0.177, "Borough": "Manhattan", "Zone": "Clinton East", "lat_wgs": 40.761398, "lon_wgs": -73.990744}, {"PULocationID": 49, "pred_rides": 0.057, "Borough": "Brooklyn", "Zone": "Clinton Hill", "lat_wgs": 40.690255, "lon_wgs": -73.961382}, {"PULocationID": 50, "pred_rides": 0.057, "Borough": "Manhattan", "Zone": "Clinton West", "lat_wgs": 40.767838, "lon_wgs": -73.997474}, {"PULocationID": 51, "pred_rides": 0.031, "Borough": "Bronx", "Zone": "Co-Op City", "lat_wgs": 40.875532, "lon_wgs": -73.83037}, {"PULocationID": 52, "pred_rides": 0.023, "Borough": "Brooklyn", "Zone": "Cobble Hill", "lat_wgs": 40.68652, "lon_wgs": -73.99624}, {"PULocationID": 53, "pred_rides": 0.02, "Borough": "Queens", "Zone": "College Point", "lat_wgs": 40.78324, "lon_wgs": -73.851061}, {"PULocationID": 54, "pred_rides": 0.012, "Borough": "Brooklyn", "Zone": "Columbia Street", "lat_wgs": 40.687492, "lon_wgs": -74.003751}, {"PULocationID": 55, "pred_rides": 0.025, "Borough": "Brooklyn", "Zone": "Coney Island", "lat_wgs": 40.575391, "lon_wgs": -73.987968}, {"PULocationID": 56, "pred_rides": 0.027, "Borough": "Queens", "Zone": "Corona", "lat_wgs": 40.740792, "lon_wgs": -73.856608}, {"PULocationID": 58, "pred_rides": 0.011, "Borough": "Bronx", "Zone": "Country Club", "lat_wgs": 40.843988, "lon_wgs": -73.815215}, {"PULocationID": 59, "pred_rides": 0.008, "Borough": "Bronx", "Zone": "Crotona Park", "lat_wgs": 40.837955, "lon_wgs": -73.895051}, {"PULocationID": 60, "pred_rides": 0.035, "Borough": "Bronx", "Zone": "Crotona Park East", "lat_wgs": 40.835268, "lon_wgs": -73.883431}, {"PULocationID": 61, "pred_rides": 0.301, "Borough": "Brooklyn", "Zone": "Crown Heights North", "lat_wgs": 40.675124, "lon_wgs": -73.935579}, {"PULocationID": 62, "pred_rides": 0.102, "Borough": "Brooklyn", "Zone": "Crown Heights South", "lat_wgs": 40.666217, "lon_wgs": -73.946329}, {"PULocationID": 63, "pred_rides": 0.036, "Borough": "Brooklyn", "Zone": "Cypress Hills", "lat_wgs": 40.680952, "lon_wgs": -73.884573}, {"PULocationID": 64, "pred_rides": 0.016, "Borough": "Queens", "Zone": "Douglaston", "lat_wgs": 40.762636, "lon_wgs": -73.748633}, {"PULocationID": 65, "pred_rides": 0.06, "Borough": "Brooklyn", "Zone": "Downtown Brooklyn/MetroTech", "lat_wgs": 40.695871, "lon_wgs": -73.985238}, {"PULocationID": 66, "pred_rides": 0.047, "Borough": "Brooklyn", "Zone": "DUMBO/Vinegar Hill", "lat_wgs": 40.703133, "lon_wgs": -73.987687}, {"PULocationID": 67, "pred_rides": 0.019, "Borough": "Brooklyn", "Zone": "Dyker Heights", "lat_wgs": 40.617434, "lon_wgs": -74.015043}, {"PULocationID": 68, "pred_rides": 0.223, "Borough": "Manhattan", "Zone": "East Chelsea", "lat_wgs": 40.748251, "lon_wgs": -74.000554}, {"PULocationID": 69, "pred_rides": 0.098, "Borough": "Bronx", "Zone": "East Concourse/Concourse Village", "lat_wgs": 40.830583, "lon_wgs": -73.915132}, {"PULocationID": 70, "pred_rides": 0.024, "Borough": "Queens", "Zone": "East Elmhurst", "lat_wgs": 40.763274, "lon_wgs": -73.865871}, {"PULocationID": 71, "pred_rides": 0.072, "Borough": "Brooklyn", "Zone": "East Flatbush/Farragut", "lat_wgs": 40.64276, "lon_wgs": -73.935957}, {"PULocationID": 72, "pred_rides": 0.062, "Borough": "Brooklyn", "Zone": "East Flatbush/Remsen Village", "lat_wgs": 40.652594, "lon_wgs": -73.921482}, {"PULocationID": 73, "pred_rides": 0.018, "Borough": "Queens", "Zone": "East Flushing", "lat_wgs": 40.752945, "lon_wgs": -73.807169}, {"PULocationID": 74, "pred_rides": 0.123, "Borough": "Manhattan", "Zone": "East Harlem North", "lat_wgs": 40.804589, "lon_wgs": -73.934012}, {"PULocationID": 75, "pred_rides": 0.109, "Borough": "Manhattan", "Zone": "East Harlem South", "lat_wgs": 40.788256, "lon_wgs": -73.941879}, {"PULocationID": 76, "pred_rides": 0.194, "Borough": "Brooklyn", "Zone": "East New York", "lat_wgs": 40.654821, "lon_wgs": -73.875537}, {"PULocationID": 77, "pred_rides": 0.042, "Borough": "Brooklyn", "Zone": "East New York/Pennsylvania Avenue", "lat_wgs": 40.667111, "lon_wgs": -73.894884}, {"PULocationID": 78, "pred_rides": 0.044, "Borough": "Bronx", "Zone": "East Tremont", "lat_wgs": 40.843783, "lon_wgs": -73.881202}, {"PULocationID": 79, "pred_rides": 0.359, "Borough": "Manhattan", "Zone": "East Village", "lat_wgs": 40.726759, "lon_wgs": -73.986487}, {"PULocationID": 80, "pred_rides": 0.174, "Borough": "Brooklyn", "Zone": "East Williamsburg", "lat_wgs": 40.715051, "lon_wgs": -73.930822}, {"PULocationID": 81, "pred_rides": 0.032, "Borough": "Bronx", "Zone": "Eastchester", "lat_wgs": 40.881657, "lon_wgs": -73.831025}, {"PULocationID": 82, "pred_rides": 0.128, "Borough": "Queens", "Zone": "Elmhurst", "lat_wgs": 40.737206, "lon_wgs": -73.87952}, {"PULocationID": 83, "pred_rides": 0.019, "Borough": "Queens", "Zone": "Elmhurst/Maspeth", "lat_wgs": 40.737892, "lon_wgs": -73.892881}, {"PULocationID": 84, "pred_rides": 0.01, "Borough": "Staten Island", "Zone": "Eltingville/Annadale/Prince's Bay", "lat_wgs": 40.520526, "lon_wgs": -74.192551}, {"PULocationID": 85, "pred_rides": 0.053, "Borough": "Brooklyn", "Zone": "Erasmus", "lat_wgs": 40.645797, "lon_wgs": -73.951888}, {"PULocationID": 86, "pred_rides": 0.031, "Borough": "Queens", "Zone": "Far Rockaway", "lat_wgs": 40.602718, "lon_wgs": -73.757557}, {"PULocationID": 87, "pred_rides": 0.146, "Borough": "Manhattan", "Zone": "Financial District North", "lat_wgs": 40.704632, "lon_wgs": -74.00555}, {"PULocationID": 88, "pred_rides": 0.041, "Borough": "Manhattan", "Zone": "Financial District South", "lat_wgs": 40.701273, "lon_wgs": -74.011811}, {"PULocationID": 89, "pred_rides": 0.124, "Borough": "Brooklyn", "Zone": "Flatbush/Ditmas Park", "lat_wgs": 40.636982, "lon_wgs": -73.962099}, {"PULocationID": 90, "pred_rides": 0.12, "Borough": "Manhattan", "Zone": "Flatiron", "lat_wgs": 40.742189, "lon_wgs": -73.996789}, {"PULocationID": 91, "pred_rides": 0.042, "Borough": "Brooklyn", "Zone": "Flatlands", "lat_wgs": 40.628121, "lon_wgs": -73.929379}, {"PULocationID": 92, "pred_rides": 0.104, "Borough": "Queens", "Zone": "Flushing", "lat_wgs": 40.760281, "lon_wgs": -73.827662}, {"PULocationID": 93, "pred_rides": 0.015, "Borough": "Queens", "Zone": "Flushing Meadows-Corona Park", "lat_wgs": 40.74752, "lon_wgs": -73.845893}, {"PULocationID": 94, "pred_rides": 0.026, "Borough": "Bronx", "Zone": "Fordham South", "lat_wgs": 40.858689, "lon_wgs": -73.898926}, {"PULocationID": 95, "pred_rides": 0.108, "Borough": "Queens", "Zone": "Forest Hills", "lat_wgs": 40.721279, "lon_wgs": -73.844788}, {"PULocationID": 96, "pred_rides": 0.012, "Borough": "Queens", "Zone": "Forest Park/Highland Park", "lat_wgs": 40.699807, "lon_wgs": -73.864212}, {"PULocationID": 97, "pred_rides": 0.193, "Borough": "Brooklyn", "Zone": "Fort Greene", "lat_wgs": 40.691577, "lon_wgs": -73.977612}, {"PULocationID": 98, "pred_rides": 0.015, "Borough": "Queens", "Zone": "Fresh Meadows", "lat_wgs": 40.731966, "lon_wgs": -73.774901}, {"PULocationID": 99, "pred_rides": 0.008, "Borough": "Staten Island", "Zone": "Freshkills Park", "lat_wgs": 40.568229, "lon_wgs": -74.203182}, {"PULocationID": 100, "pred_rides": 0.128, "Borough": "Manhattan", "Zone": "Garment District", "lat_wgs": 40.753386, "lon_wgs": -73.988716}, {"PULocationID": 101, "pred_rides": 0.014, "Borough": "Queens", "Zone": "Glen Oaks", "lat_wgs": 40.746497, "lon_wgs": -73.715607}, {"PULocationID": 102, "pred_rides": 0.027, "Borough": "Queens", "Zone": "Glendale", "lat_wgs": 40.701803, "lon_wgs": -73.877066}, {"PULocationID": 106, "pred_rides": 0.034, "Borough": "Brooklyn", "Zone": "Gowanus", "lat_wgs": 40.673823, "lon_wgs": -73.991874}, {"PULocationID": 107, "pred_rides": 0.179, "Borough": "Manhattan", "Zone": "Gramercy", "lat_wgs": 40.736706, "lon_wgs": -73.984269}, {"PULocationID": 108, "pred_rides": 0.021, "Borough": "Brooklyn", "Zone": "Gravesend", "lat_wgs": 40.586563, "lon_wgs": -73.988621}, {"PULocationID": 109, "pred_rides": 0.011, "Borough": "Staten Island", "Zone": "Great Kills", "lat_wgs": 40.543051, "lon_wgs": -74.143517}, {"PULocationID": 111, "pred_rides": 0.008, "Borough": "Brooklyn", "Zone": "Green-Wood Cemetery", "lat_wgs": 40.653079, "lon_wgs": -73.990663}, {"PULocationID": 112, "pred_rides": 0.19, "Borough": "Brooklyn", "Zone": "Greenpoint", "lat_wgs": 40.734392, "lon_wgs": -73.950516}, {"PULocationID": 113, "pred_rides": 0.072, "Borough": "Manhattan", "Zone": "Greenwich Village North", "lat_wgs": 40.731907, "lon_wgs": -73.994202}, {"PULocationID": 114, "pred_rides": 0.181, "Borough": "Manhattan", "Zone": "Greenwich Village South", "lat_wgs": 40.727635, "lon_wgs": -73.996964}, {"PULocationID": 115, "pred_rides": 0.011, "Borough": "Staten Island", "Zone": "Grymes Hill/Clifton", "lat_wgs": 40.618922, "lon_wgs": -74.084474}, {"PULocationID": 116, "pred_rides": 0.056, "Borough": "Manhattan", "Zone": "Hamilton Heights", "lat_wgs": 40.82792, "lon_wgs": -73.950727}, {"PULocationID": 117, "pred_rides": 0.021, "Borough": "Queens", "Zone": "Hammels/Arverne", "lat_wgs": 40.596829, "lon_wgs": -73.791317}, {"PULocationID": 118, "pred_rides": 0.014, "Borough": "Staten Island", "Zone": "Heartland Village/Todt Hill", "lat_wgs": 40.588551, "lon_wgs": -74.128432}, {"PULocationID": 119, "pred_rides": 0.031, "Borough": "Bronx", "Zone": "Highbridge", "lat_wgs": 40.837938, "lon_wgs": -73.926264}, {"PULocationID": 120, "pred_rides": 0.009, "Borough": "Manhattan", "Zone": "Highbridge Park", "lat_wgs": 40.844861, "lon_wgs": -73.931324}, {"PULocationID": 121, "pred_rides": 0.027, "Borough": "Queens", "Zone": "Hillcrest/Pomonok", "lat_wgs": 40.728358, "lon_wgs": -73.80536}, {"PULocationID": 122, "pred_rides": 0.021, "Borough": "Queens", "Zone": "Hollis", "lat_wgs": 40.710434, "lon_wgs": -73.764021}, {"PULocationID": 123, "pred_rides": 0.022, "Borough": "Brooklyn", "Zone": "Homecrest", "lat_wgs": 40.598265, "lon_wgs": -73.96473}, {"PULocationID": 124, "pred_rides": 0.02, "Borough": "Queens", "Zone": "Howard Beach", "lat_wgs": 40.655356, "lon_wgs": -73.847374}, {"PULocationID": 125, "pred_rides": 0.04, "Borough": "Manhattan", "Zone": "Hudson Sq", "lat_wgs": 40.72576, "lon_wgs": -74.008916}, {"PULocationID": 126, "pred_rides": 0.029, "Borough": "Bronx", "Zone": "Hunts Point", "lat_wgs": 40.807364, "lon_wgs": -73.889129}, {"PULocationID": 127, "pred_rides": 0.048, "Borough": "Manhattan", "Zone": "Inwood", "lat_wgs": 40.862595, "lon_wgs": -73.917485}, {"PULocationID": 128, "pred_rides": 0.012, "Borough": "Manhattan", "Zone": "Inwood Hill Park", "lat_wgs": 40.874656, "lon_wgs": -73.92138}, {"PULocationID": 129, "pred_rides": 0.094, "Borough": "Queens", "Zone": "Jackson Heights", "lat_wgs": 40.759475, "lon_wgs": -73.887182}, {"PULocationID": 130, "pred_rides": 0.164, "Borough": "Queens", "Zone": "Jamaica", "lat_wgs": 40.706139, "lon_wgs": -73.790528}, {"PULocationID": 131, "pred_rides": 0.017, "Borough": "Queens", "Zone": "Jamaica Estates", "lat_wgs": 40.719546, "lon_wgs": -73.777825}, {"PULocationID": 132, "pred_rides": 0.463, "Borough": "Queens", "Zone": "JFK Airport", "lat_wgs": 40.639071, "lon_wgs": -73.783741}, {"PULocationID": 133, "pred_rides": 0.016, "Borough": "Brooklyn", "Zone": "Kensington", "lat_wgs": 40.640734, "lon_wgs": -73.97651}, {"PULocationID": 134, "pred_rides": 0.018, "Borough": "Queens", "Zone": "Kew Gardens", "lat_wgs": 40.708555, "lon_wgs": -73.83162}, {"PULocationID": 135, "pred_rides": 0.018, "Borough": "Queens", "Zone": "Kew Gardens Hills", "lat_wgs": 40.727876, "lon_wgs": -73.820876}, {"PULocationID": 136, "pred_rides": 0.034, "Borough": "Bronx", "Zone": "Kingsbridge Heights", "lat_wgs": 40.865124, "lon_wgs": -73.907761}, {"PULocationID": 137, "pred_rides": 0.099, "Borough": "Manhattan", "Zone": "Kips Bay", "lat_wgs": 40.737885, "lon_wgs": -73.973821}, {"PULocationID": 138, "pred_rides": 0.641, "Borough": "Queens", "Zone": "LaGuardia Airport", "lat_wgs": 40.774628, "lon_wgs": -73.872821}, {"PULocationID": 139, "pred_rides": 0.023, "Borough": "Queens", "Zone": "Laurelton", "lat_wgs": 40.676719, "lon_wgs": -73.745068}, {"PULocationID": 140, "pred_rides": 0.08, "Borough": "Manhattan", "Zone": "Lenox Hill East", "lat_wgs": 40.763907, "lon_wgs": -73.95572}, {"PULocationID": 141, "pred_rides": 0.063, "Borough": "Manhattan", "Zone": "Lenox Hill West", "lat_wgs": 40.76562, "lon_wgs": -73.960113}, {"PULocationID": 142, "pred_rides": 0.062, "Borough": "Manhattan", "Zone": "Lincoln Square East", "lat_wgs": 40.771314, "lon_wgs": -73.982296}, {"PULocationID": 143, "pred_rides": 0.035, "Borough": "Manhattan", "Zone": "Lincoln Square West", "lat_wgs": 40.776394, "lon_wgs": -73.990065}, {"PULocationID": 144, "pred_rides": 0.146, "Borough": "Manhattan", "Zone": "Little Italy/NoLiTa", "lat_wgs": 40.72097, "lon_wgs": -73.996675}, {"PULocationID": 145, "pred_rides": 0.161, "Borough": "Queens", "Zone": "Long Island City/Hunters Point", "lat_wgs": 40.742516, "lon_wgs": -73.954881}, {"PULocationID": 146, "pred_rides": 0.039, "Borough": "Queens", "Zone": "Long Island City/Queens Plaza", "lat_wgs": 40.75312, "lon_wgs": -73.935791}, {"PULocationID": 147, "pred_rides": 0.019, "Borough": "Bronx", "Zone": "Longwood", "lat_wgs": 40.819743, "lon_wgs": -73.898566}, {"PULocationID": 148, "pred_rides": 0.325, "Borough": "Manhattan", "Zone": "Lower East Side", "lat_wgs": 40.718267, "lon_wgs": -73.991218}, {"PULocationID": 149, "pred_rides": 0.016, "Borough": "Brooklyn", "Zone": "Madison", "lat_wgs": 40.605565, "lon_wgs": -73.946444}, {"PULocationID": 150, "pred_rides": 0.013, "Borough": "Brooklyn", "Zone": "Manhattan Beach", "lat_wgs": 40.581247, "lon_wgs": -73.94123}, {"PULocationID": 151, "pred_rides": 0.03, "Borough": "Manhattan", "Zone": "Manhattan Valley", "lat_wgs": 40.799377, "lon_wgs": -73.97101}, {"PULocationID": 152, "pred_rides": 0.026, "Borough": "Manhattan", "Zone": "Manhattanville", "lat_wgs": 40.81964, "lon_wgs": -73.956132}, {"PULocationID": 153, "pred_rides": 0.013, "Borough": "Manhattan", "Zone": "Marble Hill", "lat_wgs": 40.874569, "lon_wgs": -73.911817}, {"PULocationID": 154, "pred_rides": 0.009, "Borough": "Brooklyn", "Zone": "Marine Park/Floyd Bennett Field", "lat_wgs": 40.594565, "lon_wgs": -73.914743}, {"PULocationID": 155, "pred_rides": 0.026, "Borough": "Brooklyn", "Zone": "Marine Park/Mill Basin", "lat_wgs": 40.613249, "lon_wgs": -73.901998}, {"PULocationID": 156, "pred_rides": 0.021, "Borough": "Staten Island", "Zone": "Mariners Harbor", "lat_wgs": 40.640789, "lon_wgs": -74.173924}, {"PULocationID": 157, "pred_rides": 0.022, "Borough": "Queens", "Zone": "Maspeth", "lat_wgs": 40.723504, "lon_wgs": -73.903918}, {"PULocationID": 158, "pred_rides": 0.129, "Borough": "Manhattan", "Zone": "Meatpacking/West Village West", "lat_wgs": 40.736896, "lon_wgs": -74.010486}, {"PULocationID": 159, "pred_rides": 0.052, "Borough": "Bronx", "Zone": "Melrose South", "lat_wgs": 40.819891, "lon_wgs": -73.913451}, {"PULocationID": 160, "pred_rides": 0.016, "Borough": "Queens", "Zone": "Middle Village", "lat_wgs": 40.719346, "lon_wgs": -73.882976}, {"PULocationID": 161, "pred_rides": 0.321, "Borough": "Manhattan", "Zone": "Midtown Center", "lat_wgs": 40.757753, "lon_wgs": -73.97735}, {"PULocationID": 162, "pred_rides": 0.173, "Borough": "Manhattan", "Zone": "Midtown East", "lat_wgs": 40.756517, "lon_wgs": -73.972625}, {"PULocationID": 163, "pred_rides": 0.166, "Borough": "Manhattan", "Zone": "Midtown North", "lat_wgs": 40.765561, "lon_wgs": -73.978757}, {"PULocationID": 164, "pred_rides": 0.248, "Borough": "Manhattan", "Zone": "Midtown South", "lat_wgs": 40.748532, "lon_wgs": -73.984748}, {"PULocationID": 165, "pred_rides": 0.026, "Borough": "Brooklyn", "Zone": "Midwood", "lat_wgs": 40.621716, "lon_wgs": -73.958221}, {"PULocationID": 166, "pred_rides": 0.034, "Borough": "Manhattan", "Zone": "Morningside Heights", "lat_wgs": 40.810671, "lon_wgs": -73.963613}, {"PULocationID": 167, "pred_rides": 0.035, "Borough": "Bronx", "Zone": "Morrisania/Melrose", "lat_wgs": 40.825669, "lon_wgs": -73.905021}, {"PULocationID": 168, "pred_rides": 0.097, "Borough": "Bronx", "Zone": "Mott Haven/Port Morris", "lat_wgs": 40.80426, "lon_wgs": -73.91207}, {"PULocationID": 169, "pred_rides": 0.049, "Borough": "Bronx", "Zone": "Mount Hope", "lat_wgs": 40.848149, "lon_wgs": -73.906359}, {"PULocationID": 170, "pred_rides": 0.151, "Borough": "Manhattan", "Zone": "Murray Hill", "lat_wgs": 40.747473, "lon_wgs": -73.978303}, {"PULocationID": 171, "pred_rides": 0.021, "Borough": "Queens", "Zone": "Murray Hill-Queens", "lat_wgs": 40.768051, "lon_wgs": -73.807583}, {"PULocationID": 172, "pred_rides": 0.014, "Borough": "Staten Island", "Zone": "New Dorp/Midland Beach", "lat_wgs": 40.568898, "lon_wgs": -74.104626}, {"PULocationID": 173, "pred_rides": 0.039, "Borough": "Queens", "Zone": "North Corona", "lat_wgs": 40.75418, "lon_wgs": -73.861459}, {"PULocationID": 174, "pred_rides": 0.061, "Borough": "Bronx", "Zone": "Norwood", "lat_wgs": 40.878665, "lon_wgs": -73.882016}, {"PULocationID": 175, "pred_rides": 0.018, "Borough": "Queens", "Zone": "Oakland Gardens", "lat_wgs": 40.743646, "lon_wgs": -73.755258}, {"PULocationID": 176, "pred_rides": 0.011, "Borough": "Staten Island", "Zone": "Oakwood", "lat_wgs": 40.564555, "lon_wgs": -74.121358}, {"PULocationID": 177, "pred_rides": 0.047, "Borough": "Brooklyn", "Zone": "Ocean Hill", "lat_wgs": 40.677068, "lon_wgs": -73.912029}, {"PULocationID": 178, "pred_rides": 0.012, "Borough": "Brooklyn", "Zone": "Ocean Parkway South", "lat_wgs": 40.617847, "lon_wgs": -73.971504}, {"PULocationID": 179, "pred_rides": 0.037, "Borough": "Queens", "Zone": "Old Astoria", "lat_wgs": 40.772395, "lon_wgs": -73.930123}, {"PULocationID": 180, "pred_rides": 0.025, "Borough": "Queens", "Zone": "Ozone Park", "lat_wgs": 40.676308, "lon_wgs": -73.848528}, {"PULocationID": 181, "pred_rides": 0.269, "Borough": "Brooklyn", "Zone": "Park Slope", "lat_wgs": 40.670746, "lon_wgs": -73.980671}, {"PULocationID": 182, "pred_rides": 0.024, "Borough": "Bronx", "Zone": "Parkchester", "lat_wgs": 40.837095, "lon_wgs": -73.858634}, {"PULocationID": 183, "pred_rides": 0.021, "Borough": "Bronx", "Zone": "Pelham Bay", "lat_wgs": 40.849369, "lon_wgs": -73.831104}, {"PULocationID": 184, "pred_rides": 0.011, "Borough": "Bronx", "Zone": "Pelham Bay Park", "lat_wgs": 40.862239, "lon_wgs": -73.79655}, {"PULocationID": 185, "pred_rides": 0.029, "Borough": "Bronx", "Zone": "Pelham Parkway", "lat_wgs": 40.85437, "lon_wgs": -73.852955}, {"PULocationID": 186, "pred_rides": 0.14, "Borough": "Manhattan", "Zone": "Penn Station/Madison Sq West", "lat_wgs": 40.748585, "lon_wgs": -73.991999}, {"PULocationID": 187, "pred_rides": 0.01, "Borough": "Staten Island", "Zone": "Port Richmond", "lat_wgs": 40.632707, "lon_wgs": -74.13613}, {"PULocationID": 188, "pred_rides": 0.168, "Borough": "Brooklyn", "Zone": "Prospect-Lefferts Gardens", "lat_wgs": 40.658743, "lon_wgs": -73.948091}, {"PULocationID": 189, "pred_rides": 0.074, "Borough": "Brooklyn", "Zone": "Prospect Heights", "lat_wgs": 40.676709, "lon_wgs": -73.968131}, {"PULocationID": 190, "pred_rides": 0.01, "Borough": "Brooklyn", "Zone": "Prospect Park", "lat_wgs": 40.661061, "lon_wgs": -73.97257}, {"PULocationID": 191, "pred_rides": 0.028, "Borough": "Queens", "Zone": "Queens Village", "lat_wgs": 40.71693, "lon_wgs": -73.742429}, {"PULocationID": 192, "pred_rides": 0.021, "Borough": "Queens", "Zone": "Queensboro Hill", "lat_wgs": 40.744062, "lon_wgs": -73.814652}, {"PULocationID": 193, "pred_rides": 0.018, "Borough": "Queens", "Zone": "Queensbridge/Ravenswood", "lat_wgs": 40.762743, "lon_wgs": -73.939093}, {"PULocationID": 194, "pred_rides": 0.009, "Borough": "Manhattan", "Zone": "Randalls Island", "lat_wgs": 40.791829, "lon_wgs": -73.925739}, {"PULocationID": 195, "pred_rides": 0.026, "Borough": "Brooklyn", "Zone": "Red Hook", "lat_wgs": 40.674447, "lon_wgs": -74.013032}, {"PULocationID": 196, "pred_rides": 0.027, "Borough": "Queens", "Zone": "Rego Park", "lat_wgs": 40.726171, "lon_wgs": -73.863958}, {"PULocationID": 197, "pred_rides": 0.031, "Borough": "Queens", "Zone": "Richmond Hill", "lat_wgs": 40.695486, "lon_wgs": -73.829096}, {"PULocationID": 198, "pred_rides": 0.153, "Borough": "Queens", "Zone": "Ridgewood", "lat_wgs": 40.70736, "lon_wgs": -73.904168}, {"PULocationID": 200, "pred_rides": 0.014, "Borough": "Bronx", "Zone": "Riverdale/North Riverdale/Fieldston", "lat_wgs": 40.898949, "lon_wgs": -73.908185}, {"PULocationID": 201, "pred_rides": 0.018, "Borough": "Queens", "Zone": "Rockaway Park", "lat_wgs": 40.578754, "lon_wgs": -73.838247}, {"PULocationID": 202, "pred_rides": 0.018, "Borough": "Manhattan", "Zone": "Roosevelt Island", "lat_wgs": 40.761763, "lon_wgs": -73.950211}, {"PULocationID": 203, "pred_rides": 0.023, "Borough": "Queens", "Zone": "Rosedale", "lat_wgs": 40.644091, "lon_wgs": -73.744925}, {"PULocationID": 204, "pred_rides": 0.012, "Borough": "Staten Island", "Zone": "Rossville/Woodrow", "lat_wgs": 40.539924, "lon_wgs": -74.208846}, {"PULocationID": 205, "pred_rides": 0.039, "Borough": "Queens", "Zone": "Saint Albans", "lat_wgs": 40.692876, "lon_wgs": -73.764272}, {"PULocationID": 206, "pred_rides": 0.02, "Borough": "Staten Island", "Zone": "Saint George/New Brighton", "lat_wgs": 40.640559, "lon_wgs": -74.099941}, {"PULocationID": 207, "pred_rides": 0.01, "Borough": "Queens", "Zone": "Saint Michaels Cemetery/Woodside", "lat_wgs": 40.763765, "lon_wgs": -73.897653}, {"PULocationID": 208, "pred_rides": 0.04, "Borough": "Bronx", "Zone": "Schuylerville/Edgewater Park", "lat_wgs": 40.82016, "lon_wgs": -73.814851}, {"PULocationID": 209, "pred_rides": 0.037, "Borough": "Manhattan", "Zone": "Seaport", "lat_wgs": 40.708273, "lon_wgs": -74.002267}, {"PULocationID": 210, "pred_rides": 0.031, "Borough": "Brooklyn", "Zone": "Sheepshead Bay", "lat_wgs": 40.590004, "lon_wgs": -73.930137}, {"PULocationID": 211, "pred_rides": 0.119, "Borough": "Manhattan", "Zone": "SoHo", "lat_wgs": 40.723511, "lon_wgs": -74.002191}, {"PULocationID": 212, "pred_rides": 0.031, "Borough": "Bronx", "Zone": "Soundview/Bruckner", "lat_wgs": 40.827967, "lon_wgs": -73.868166}, {"PULocationID": 213, "pred_rides": 0.065, "Borough": "Bronx", "Zone": "Soundview/Castle Hill", "lat_wgs": 40.815351, "lon_wgs": -73.850366}, {"PULocationID": 214, "pred_rides": 0.019, "Borough": "Staten Island", "Zone": "South Beach/Dongan Hills", "lat_wgs": 40.583925, "lon_wgs": -74.079294}, {"PULocationID": 215, "pred_rides": 0.032, "Borough": "Queens", "Zone": "South Jamaica", "lat_wgs": 40.694743, "lon_wgs": -73.792073}, {"PULocationID": 216, "pred_rides": 0.073, "Borough": "Queens", "Zone": "South Ozone Park", "lat_wgs": 40.676477, "lon_wgs": -73.817131}, {"PULocationID": 217, "pred_rides": 0.016, "Borough": "Brooklyn", "Zone": "South Williamsburg", "lat_wgs": 40.704057, "lon_wgs": -73.958038}, {"PULocationID": 218, "pred_rides": 0.027, "Borough": "Queens", "Zone": "Springfield Gardens North", "lat_wgs": 40.672931, "lon_wgs": -73.772761}, {"PULocationID": 219, "pred_rides": 0.018, "Borough": "Queens", "Zone": "Springfield Gardens South", "lat_wgs": 40.661963, "lon_wgs": -73.770403}, {"PULocationID": 220, "pred_rides": 0.03, "Borough": "Bronx", "Zone": "Spuyten Duyvil/Kingsbridge", "lat_wgs": 40.882296, "lon_wgs": -73.91205}, {"PULocationID": 221, "pred_rides": 0.017, "Borough": "Staten Island", "Zone": "Stapleton", "lat_wgs": 40.620458, "lon_wgs": -74.072192}, {"PULocationID": 222, "pred_rides": 0.015, "Borough": "Brooklyn", "Zone": "Starrett City", "lat_wgs": 40.644776, "lon_wgs": -73.884129}, {"PULocationID": 223, "pred_rides": 0.04, "Borough": "Queens", "Zone": "Steinway", "lat_wgs": 40.782079, "lon_wgs": -73.8957}, {"PULocationID": 224, "pred_rides": 0.033, "Borough": "Manhattan", "Zone": "Stuy Town/Peter Cooper Village", "lat_wgs": 40.731622, "lon_wgs": -73.974325}, {"PULocationID": 225, "pred_rides": 0.145, "Borough": "Brooklyn", "Zone": "Stuyvesant Heights", "lat_wgs": 40.688738, "lon_wgs": -73.930469}, {"PULocationID": 226, "pred_rides": 0.1, "Borough": "Queens", "Zone": "Sunnyside", "lat_wgs": 40.727, "lon_wgs": -73.925836}, {"PULocationID": 227, "pred_rides": 0.027, "Borough": "Brooklyn", "Zone": "Sunset Park East", "lat_wgs": 40.639752, "lon_wgs": -74.006864}, {"PULocationID": 228, "pred_rides": 0.073, "Borough": "Brooklyn", "Zone": "Sunset Park West", "lat_wgs": 40.655479, "lon_wgs": -74.011949}, {"PULocationID": 229, "pred_rides": 0.115, "Borough": "Manhattan", "Zone": "Sutton Place/Turtle Bay North", "lat_wgs": 40.755784, "lon_wgs": -73.964284}, {"PULocationID": 230, "pred_rides": 0.391, "Borough": "Manhattan", "Zone": "Times Sq/Theatre District", "lat_wgs": 40.759607, "lon_wgs": -73.984313}, {"PULocationID": 231, "pred_rides": 0.273, "Borough": "Manhattan", "Zone": "TriBeCa/Civic Center", "lat_wgs": 40.718848, "lon_wgs": -74.00988}, {"PULocationID": 232, "pred_rides": 0.051, "Borough": "Manhattan", "Zone": "Two Bridges/Seward Park", "lat_wgs": 40.713594, "lon_wgs": -73.982954}, {"PULocationID": 233, "pred_rides": 0.054, "Borough": "Manhattan", "Zone": "UN/Turtle Bay South", "lat_wgs": 40.746299, "lon_wgs": -73.969564}, {"PULocationID": 234, "pred_rides": 0.281, "Borough": "Manhattan", "Zone": "Union Sq", "lat_wgs": 40.73931, "lon_wgs": -73.990131}, {"PULocationID": 235, "pred_rides": 0.034, "Borough": "Bronx", "Zone": "University Heights/Morris Heights", "lat_wgs": 40.854132, "lon_wgs": -73.917159}, {"PULocationID": 236, "pred_rides": 0.08, "Borough": "Manhattan", "Zone": "Upper East Side North", "lat_wgs": 40.780263, "lon_wgs": -73.957138}, {"PULocationID": 237, "pred_rides": 0.124, "Borough": "Manhattan", "Zone": "Upper East Side South", "lat_wgs": 40.768456, "lon_wgs": -73.965666}, {"PULocationID": 238, "pred_rides": 0.034, "Borough": "Manhattan", "Zone": "Upper West Side North", "lat_wgs": 40.792388, "lon_wgs": -73.974066}, {"PULocationID": 239, "pred_rides": 0.061, "Borough": "Manhattan", "Zone": "Upper West Side South", "lat_wgs": 40.784791, "lon_wgs": -73.98317}, {"PULocationID": 240, "pred_rides": 0.012, "Borough": "Bronx", "Zone": "Van Cortlandt Park", "lat_wgs": 40.890801, "lon_wgs": -73.879084}, {"PULocationID": 241, "pred_rides": 0.035, "Borough": "Bronx", "Zone": "Van Cortlandt Village", "lat_wgs": 40.875343, "lon_wgs": -73.895972}, {"PULocationID": 242, "pred_rides": 0.034, "Borough": "Bronx", "Zone": "Van Nest/Morris Park", "lat_wgs": 40.848515, "lon_wgs": -73.849231}, {"PULocationID": 243, "pred_rides": 0.039, "Borough": "Manhattan", "Zone": "Washington Heights North", "lat_wgs": 40.857373, "lon_wgs": -73.93752}, {"PULocationID": 244, "pred_rides": 0.123, "Borough": "Manhattan", "Zone": "Washington Heights South", "lat_wgs": 40.84285, "lon_wgs": -73.943256}, {"PULocationID": 245, "pred_rides": 0.013, "Borough": "Staten Island", "Zone": "West Brighton", "lat_wgs": 40.632347, "lon_wgs": -74.103797}, {"PULocationID": 246, "pred_rides": 0.222, "Borough": "Manhattan", "Zone": "West Chelsea/Hudson Yards", "lat_wgs": 40.750105, "lon_wgs": -74.008111}, {"PULocationID": 247, "pred_rides": 0.084, "Borough": "Bronx", "Zone": "West Concourse", "lat_wgs": 40.830234, "lon_wgs": -73.924077}, {"PULocationID": 248, "pred_rides": 0.025, "Borough": "Bronx", "Zone": "West Farms/Bronx River", "lat_wgs": 40.834862, "lon_wgs": -73.873662}, {"PULocationID": 249, "pred_rides": 0.293, "Borough": "Manhattan", "Zone": "West Village", "lat_wgs": 40.733811, "lon_wgs": -74.003081}, {"PULocationID": 250, "pred_rides": 0.02, "Borough": "Bronx", "Zone": "Westchester Village/Unionport", "lat_wgs": 40.834345, "lon_wgs": -73.844962}, {"PULocationID": 251, "pred_rides": 0.014, "Borough": "Staten Island", "Zone": "Westerleigh", "lat_wgs": 40.616504, "lon_wgs": -74.126074}, {"PULocationID": 252, "pred_rides": 0.017, "Borough": "Queens", "Zone": "Whitestone", "lat_wgs": 40.795098, "lon_wgs": -73.814988}, {"PULocationID": 253, "pred_rides": 0.008, "Borough": "Queens", "Zone": "Willets Point", "lat_wgs": 40.762045, "lon_wgs": -73.842202}, {"PULocationID": 254, "pred_rides": 0.077, "Borough": "Bronx", "Zone": "Williamsbridge/Olinville", "lat_wgs": 40.882393, "lon_wgs": -73.859056}, {"PULocationID": 255, "pred_rides": 0.235, "Borough": "Brooklyn", "Zone": "Williamsburg (North Side)", "lat_wgs": 40.719652, "lon_wgs": -73.961672}, {"PULocationID": 256, "pred_rides": 0.203, "Borough": "Brooklyn", "Zone": "Williamsburg (South Side)", "lat_wgs": 40.710736, "lon_wgs": -73.96294}, {"PULocationID": 257, "pred_rides": 0.019, "Borough": "Brooklyn", "Zone": "Windsor Terrace", "lat_wgs": 40.656034, "lon_wgs": -73.978426}, {"PULocationID": 258, "pred_rides": 0.021, "Borough": "Queens", "Zone": "Woodhaven", "lat_wgs": 40.687641, "lon_wgs": -73.854732}, {"PULocationID": 259, "pred_rides": 0.039, "Borough": "Bronx", "Zone": "Woodlawn/Wakefield", "lat_wgs": 40.900108, "lon_wgs": -73.853635}, {"PULocationID": 260, "pred_rides": 0.079, "Borough": "Queens", "Zone": "Woodside", "lat_wgs": 40.746439, "lon_wgs": -73.905908}, {"PULocationID": 261, "pred_rides": 0.075, "Borough": "Manhattan", "Zone": "World Trade Center", "lat_wgs": 40.707456, "lon_wgs": -74.013983}, {"PULocationID": 262, "pred_rides": 0.025, "Borough": "Manhattan", "Zone": "Yorkville East", "lat_wgs": 40.778363, "lon_wgs": -73.943489}, {"PULocationID": 263, "pred_rides": 0.081, "Borough": "Manhattan", "Zone": "Yorkville West", "lat_wgs": 40.77902, "lon_wgs": -73.950199}];

// ===== 地圖初始化 =====
var map = L.map('map').setView([40.72708529411764, -73.92932112156862], 11);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom:19
}).addTo(map);

// ===== 車子 icon =====
var carIcon = L.icon({
  iconUrl: './taxi.jpg',
  iconSize: [42,42],
  iconAnchor: [21,21]
});

// ===== 畫需求氣泡 =====
zones.forEach(function(z){
  var color =
    z.pred_rides > 0.8 ? '#ff0000' :
    z.pred_rides > 0.5 ? '#ff9800' :
    z.pred_rides > 0.1 ? '#ffff00' :
                        '#00c853';

  L.circleMarker([z.lat_wgs, z.lon_wgs], {
    radius: Math.min(35, z.pred_rides * 2 + 5),
    color: color,
    fillColor: color,
    fillOpacity: 0.6
  }).bindTooltip(
    "Zone：" + z.Zone + "<br>需求：" + z.pred_rides,
    {sticky:true}
  ).addTo(map);
});

// ===== 直線距離（公里） =====
function haversine(lat1, lon1, lat2, lon2){
  var R = 6371;
  var dLat = (lat2-lat1)*Math.PI/180;
  var dLon = (lon2-lon1)*Math.PI/180;
  var a =
    Math.sin(dLat/2)**2 +
    Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180) *
    Math.sin(dLon/2)**2;
  return R * (2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)));
}

// ===== 預估車資（簡化版） =====
function estimateFare(dist_km){
  var base = 2.5;
  var perKm = 1.5;
  return base + perKm * Math.max(1, dist_km);
}

// ===== 綜合分數：需求 + 車資 - 距離 =====
function calcScore(pred, dist_km, fare){
  return pred * 1.0 + fare * 0.3 - dist_km * 0.5;
}

// ===== OSRM 路線 =====
async function getRoute(fromLat, fromLon, toLat, toLon){
  var url = `https://router.project-osrm.org/route/v1/driving/${fromLon},${fromLat};${toLon},${toLat}?overview=full&geometries=geojson`;
  try {
    var res = await fetch(url);
    var data = await res.json();
    if (!data.routes || !data.routes.length){
      return {coords: [], dist: null};
    }
    var r = data.routes[0];
    return {
      coords: r.geometry.coordinates.map(c => [c[1], c[0]]),
      dist: r.distance / 1000.0
    };
  } catch(e){
    return {coords: [], dist: null};
  }
}

// ===== 小車動畫 =====
var carMarker = null;
var carTimer = null;

function playCar(route){
  if (carTimer){
    clearInterval(carTimer);
    carTimer = null;
  }
  if (carMarker){
    map.removeLayer(carMarker);
    carMarker = null;
  }
  if (!route.coords || route.coords.length < 2) return;

  carMarker = L.marker(route.coords[0], {icon: carIcon}).addTo(map);
  map.fitBounds(L.latLngBounds(route.coords), {padding:[30,30]});

  var i = 0;
  carTimer = setInterval(function(){
    i++;
    if (i >= route.coords.length){
      clearInterval(carTimer);
      carTimer = null;
      return;
    }
    carMarker.setLatLng(route.coords[i]);
  }, 80);
}

// 存目前路線的 polyline
var routeLayers = [];

// ===== 點地圖：計算推薦 Top3 =====
map.on('click', async function(e){
  var lat = e.latlng.lat;
  var lon = e.latlng.lng;

  document.getElementById("driver-pos").innerHTML =
    "司機位置：<br>lat=" + lat.toFixed(5) + "<br>lon=" + lon.toFixed(5);

  // 清掉舊路線
  routeLayers.forEach(function(l){ map.removeLayer(l); });
  routeLayers = [];

  // 先用直線距離粗排
  var initial = zones.map(function(z){
    var d = haversine(lat, lon, z.lat_wgs, z.lon_wgs);
    var f = estimateFare(d);
    return {
      info: z,
      straightDist: d,
      approxScore: calcScore(z.pred_rides, d, f)
    };
  }).sort(function(a,b){ return b.approxScore - a.approxScore; }).slice(0,3);

  // 取得路線並重新計分
  var top3 = [];
  for (let item of initial){
    var z = item.info;
    var routeInfo = await getRoute(lat, lon, z.lat_wgs, z.lon_wgs);
    var dist = routeInfo.dist != null ? routeInfo.dist : item.straightDist;
    var f = estimateFare(dist);

    top3.push({
      info: z,
      coords: (routeInfo.coords && routeInfo.coords.length)
                ? routeInfo.coords
                : [[lat,lon],[z.lat_wgs,z.lon_wgs]],
      dist_km: dist,
      fare: f,
      score: calcScore(z.pred_rides, dist, f)
    });
  }

  top3.sort(function(a,b){ return b.score - a.score; });

  // 畫三條路線
  var colors = ["blue","green","purple"];
  top3.forEach(function(t, idx){
    var poly = L.polyline(t.coords, {
      color: colors[idx] || "blue",
      weight: 5,
      opacity: 0.8
    }).addTo(map);
    routeLayers.push(poly);
  });

  // 更新右邊卡片
  var rankDiv = document.getElementById("rank");
  rankDiv.innerHTML = "";

  top3.forEach(function(t, idx){
    var z = t.info;
    var card = document.createElement("div");
    card.className = "zone-card top" + (idx+1);

    card.innerHTML =
      "<b>第 " + (idx+1) + " 名</b><br>" +
      "Zone：" + z.Zone + " (ID:" + z.PULocationID + ")<br>" +
      "預測需求：" + z.pred_rides + "<br>" +
      "距離：" + t.dist_km.toFixed(2) + " km<br>" +
      "預估車資：約 $" + t.fare.toFixed(1) + "<br>" +
      "綜合分數：" + t.score.toFixed(2);

    card.onclick = function(){ playCar(t); };
    rankDiv.appendChild(card);
  });
});
</script>

</body>
</html>
